package edu.cmu.cs.graphics.crowdsim.drivers;

import java.util.ArrayList;
import java.util.List;
import java.util.function.Consumer;

import org.apache.commons.cli.CommandLine;
import org.apache.commons.cli.CommandLineParser;
import org.apache.commons.cli.DefaultParser;
import org.apache.commons.cli.Options;
import org.apache.commons.cli.ParseException;

import edu.cmu.cs.graphics.crowdsim.module.ListenOn;
import edu.cmu.cs.graphics.crowdsim.module.SubModule;

/**
 * 
 * Represents a module that will be able to add or modify the command line arguments before
 * we process them. This will happen before the game actually starts, and we load the 
 * initial game environment.
 * 
 * This will allow certain game aspects to change the behavior of the command line arguments.
 * 
 * It is highly suggested that modules should NOT modify the command line arguments after they have
 * already been processed, such that the only modules that implement the ArgsListener class
 * are loaded with Game.mod.
 * 
 * Usage: extend command line arguments using the accept method.
 * 
 * @author zkieda
 */
@ListenOn(ArgsListenerModule.ArgsListener.class)
public class ArgsListenerModule extends SubModule implements Consumer<ArgsListenerModule.ArgsListener> {
	
	// the options that we will use
	private final Options o = new Options();
	private final List<ArgsListener> listeners = new ArrayList<>();
	private String[] args;
	
	public static interface ArgsListener {
		public void modifyOptions(Options o);
		public void result(CommandLine cl);
	}
	
	
	
	public void init(String[] args){
		this.args = args;
	}
	
	@Override
	public void accept(ArgsListener t) {
		// t represents some consumer that will modify the command line options.
		t.modifyOptions(o);
		listeners.add(t);
	}
	
	public void processArgs() throws ParseException{
		final CommandLineParser parser = new DefaultParser();
		final CommandLine result = parser.parse(o, args, true);
		listeners.forEach(l -> l.result(result));
	}
}

